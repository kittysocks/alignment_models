---
title: "ShinyApp Plots - Most Common Model Percentage Against Data Properties of Given Datasets"
author: "Molly Miraglia"
---

```{r, include=FALSE}
library(tidyverse)
library(magrittr)
```

Here is the dataset that contains the data properties, let's read it in!


```{r}
one_csv <- read_csv(file="one_csv.csv")
```


We will be wrangling data from these two datasets, then binding them together. 

```{r}
aa_ranked <- read_csv(file="../aa_ranked_models.csv")
nt_ranked <- read_csv(file="../nt_ranked_models.csv")
```

#Data Wrangling of Two Ranked Datasets To Get Clean!

```{r}
aa_ranked %>%
  separate(name,into=c("ensembl","taxonomy","transcript","datatype","fasta")) %>%
  select(-fasta) %>%
  unite("name",c(ensembl,taxonomy,transcript)) -> aa_ranked_clean

nt_ranked %>% 
  separate(name,into=c("ensembl","taxonomy","transcript","datatype","fasta")) %>%
  select(-fasta) %>%
  unite("name",ensembl,taxonomy,transcript) -> nt_ranked_clean

all_ranked <- bind_rows(nt_ranked_clean,aa_ranked_clean)

```

#Time to Get Most Common Model!

```{r}
most_common_model <- all_ranked %>%
  count(name,ic_type,datatype) %>%
  rename(total=n) %>%
  left_join(all_ranked) %>%
  select(-number) %>%
  count(name,total,Model,ic_type,datatype) %>%
  group_by(name,ic_type,datatype) %>%
  mutate(percentm = max(n)/total) %>%
  mutate(topmodelnum=max(n)) %>%
  select(-total,-Model,-n) %>%
  distinct() %>%
  ungroup() 

```


Alright, so each dataset should have 6 names each, because of the 3 information criterion for each dataset(2).

Now need to link up with data properties `one_csv`

```{r}

new_named <- most_common_model %>% 
  separate("name",c("a","b","c")) %>%
  unite("name",a,b,c,sep=".") %>%
  rename(percent_ic_type=ic_type)

all_one_csv <- left_join(new_named,one_csv,by="name") %>%
  distinct() %>%
  ungroup() 
  
```
Alright, so I made a new variable, and it has three `percent_ic_types` per `ic_type`, in order to graph it. I don't think this is right, but let's try.

#Graphing!

What I'm currently doing is trying to plot the most common model percentage against a variable, suchh as a data property of the datasets, to see the correlation. 


```{r}

all_one_csv %>%
  drop_na() %>%
  ggplot(aes(x=percentm,y=mean_pairwise_distance)) +
  geom_point() +
  facet_grid(ic_type ~datatype) +
  scale_color_manual(labels=c("aa","nt"),values=c("palevioletred","cornflowerblue"))

```

Need to reactively program these graphs in ShinyApp. 





