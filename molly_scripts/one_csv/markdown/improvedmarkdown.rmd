---
title: "Plots Pertaining to Data Properties of Alignments, Specifically Percentage of Most Common Model"
author: "Molly Miraglia"
---

```{r, include=FALSE}
library(tidyverse)
library(magrittr)
```

This is a new markdown file with plots pertaining to model common model percentage. 

Here I will be reading in a csv files that contains the data properties collected and then will be reading in code that collects most common model percentage.

```{r}
one_csv <- read_csv(file="one_csv.csv")
```

Most common model percentage is the most chosen model out of the 50 alignments based on a certain information criterion. For example, for the AIC information criterion, if there are 48 models that are JTT+WAG but then 2 models are JTT+WAG+G, then the most common model percentage would be 96%. 

Below is code that will transform the `ranked_models.csv` files into most common model percentage. 

First I'll read in the two files (based on aa and nt data) that will be transformed. 


```{r}
aa_ranked <- read_csv(file="../aa_ranked_models.csv")
nt_ranked <- read_csv(file="../nt_ranked_models.csv")
```

#Time to transform!

```{r}
total_per <- 50

aa_modelper <- aa_ranked %>%
  group_by(name, Model, ic_type) %>% 
  tally() %>%
  ungroup() %>% 
  rename(number_of_models = n) %>% 
  drop_na() %>%
  group_by(name,Model) %>%
  mutate(per=total_per) %>%
  mutate(percent=number_of_models/per) %>%
  select(-per) %>%
  ungroup() 

nt_model_per <- nt_ranked %>% 
  count(name, ic_type) %>%
  rename(total=n) %>%
  left_join(nt_ranked) %>%
  select(-number) %>%
  group_by(name,ic_type,total,Model) %>%
  tally() %>%
  rename(number_of_models=n) %>%
  mutate(percent=number_of_models/total) %>%
  ungroup() %>%
  select(-total)

# nt_ranked %>%
#     count(name, ic_type) %>%
#     rename(total=n) %>%
#     left_join(nt_ranked) %>%
#     select(-number) %>%
#     count(name,total,Model, ic_type) %>%
#     group_by(name, ic_type) %>%
#     mutate(percent_most_common = max(n) / total) %>%
#     select(-n, -Model) %>%
#     distinct()

```


As you can see, there are two different methods to transform the tidy data. There are usually a lot of different ways to wrangle data. 

Understandably concerned about the amount of chunks I create in these R Markdown files. I just like separating them a lot because of organization. Hopefully doesn't screw too much with the memory. 

I'm now going to combine the most common model percentage with `one_csv` so I can plot it.
---------------------------------------------------------------


Nevermind, not gonna join one_csv w two. Need to group by data type don't forget!


#New Data Wrangling

```{r}
aa_ranked %>%
  separate(name,into=c("ensembl","taxonomy","transcript","datatype","fasta")) %>%
  select(-fasta) %>%
  unite("name",c(ensembl,taxonomy,transcript)) -> aa_ranked_clean

nt_ranked %>% 
  separate(name,into=c("ensembl","taxonomy","transcript","datatype","fasta")) %>%
  select(-fasta) %>%
  unite("name",ensembl,taxonomy,transcript) -> nt_ranked_clean

all_ranked <- bind_rows(nt_ranked_clean,aa_ranked_clean)

```

Now going to get most common model

#Part 2 of MCM

```{r}

most_common_model <- all_ranked %>%
  count(name,ic_type,datatype) %>%
  rename(total=n) %>%
  left_join(all_ranked) %>%
  select(-number) %>%
  count(name,total,Model,ic_type,datatype) %>%
  group_by(name,ic_type,datatype) %>%
  mutate(percentm = max(n)/total) %>%
  mutate(topmodelnum=max(n)) %>%
  select(-total,-Model,-n) %>%
  distinct() %>%
  ungroup() 

```

Alright, so each dataset should have 6 names each, because of the 3 information criterion for each dataset(2).


#Now need to link up with data properties `one_csv`


```{r}

new_named <- most_common_model %>% 
  separate("name",c("a","b","c")) %>%
  unite("name",a,b,c,sep=".") %>%
  rename(percent_ic_type=ic_type)

all_one_csv <- left_join(new_named,one_csv,by="name") %>%
  distinct() %>%
  ungroup() 
  
```
Alright, so I made a new variable, and it has three `percent_ic_types` per `ic_type`, in order to graph it. I don't think this is right, but let's try.

```{r}

all_one_csv %>%
  drop_na %>%
  ggplot(aes(x=mean_seq_length,y=percentm)) +
  geom_point() +
  facet_grid(ic_type ~datatype)

```
So this plot above shows the correlation of mean sequence length with model percent.

```{r}
all_one_csv %>%
  drop_na %>%
  ggplot(aes(x=number_models,y=percentm)) +
  geom_point() +
  facet_grid(ic_type ~datatype)


```


So this graph above here shows the most common model percent over the number of models. To read this graph, on the x axis there are number of models and on the y axis there is the most common model percent. You can see that if a dataset has four models, you can see the most common model percent correlated with that point.

```{r}
all_one_csv %>%
  ggplot(aes(y=number_models,x=percentm)) +
  geom_point() +
  facet_grid(ic_type ~datatype)
```

This is the same graph, but withh the axis's switched. 

#More plotting:

```{r}
all_one_csv %>%
  drop_na() %>%
  ggplot(aes(y= percentm,x=stdev_seq_length)) + 
  geom_point() +
  facet_grid(ic_type ~datatype)
```
