---
title: "Tidying and Modeling Euteleostomi and Drosophila AA and NT Data"
output: html_document
theme: united
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
```

###Let's Try to Tidy `output_selectome/` Data!

So, what we're trying to do first is to merge all the .csv files in `output_selectome/` into one big .csv file. 
Then we're going to tidy that data, by tidying it by species, name, data type, and number of models. Maybe we'll add tidying parameters as we go along, but let's see!

Below will be some R code that's in the works, as of February 4th, 2020.

```{r,include=TRUE}
csv_directory = "../output_selectome"
csv_files <- dir(path=csv_directory,pattern="*.csv")
# Reading in all the .csv files from `output_selectome/` directory
```

After reading in the data, we need to read the actual files. The code below is to read what's in the files and merge them into one data frame.

```{r,include=FALSE,echo=FALSE}

csv_dataframe <- read_csv("../results/all_selectome_output_csvs.csv")

```

I'm unsure of how to add the code without showing all the .csv files being processed, so I'm going to not include it, but know that it's there and is visible in the actual .rmd code.

So I created a variable called `csv_dataframe` which includes all the csv files in one data frame. From here, I will be manipulating that data frame in the code below.

## Wrangle the Hell Out of this Data

``` {r, include =TRUE}
csv_dataframe %>%
  separate (name,c("name","species","STOP"),sep="[.]") %>%
  select(-filename,-STOP) 
```

So far, as of February 6th, 2020, I cleaned up the .csv by removing the variables `filename` and separating the `name` variable into `name` and `species` and deleting the transcription number that isn't needed. The ultimate goal for this .rmd is to create four separate .csv files separated by species and data type, so two Euteleostomi AA and NT and two Drosohpila AA and NT.

Let's try to gather the ic_type data now!

```{r,include=TRUE}

csv_dataframe %>%
  separate (name,c("name","species","STOP"),sep="[.]") %>%
  select(-filename,-STOP) %>%
  pivot_longer(AIC:BIC, names_to = "ic_type", values_to = "model") 

```

Ok, the ic_type data is now wrangled, with one column for the ic_type and and one column as the model. Time to rank the models, so then we can start plotting!


```{r,include=TRUE}

csv_dataframe %>%
  separate (name,c("name","species","STOP"),sep="[.]") %>%
  dplyr::select(-filename,-STOP) %>%
  pivot_longer(AIC:BIC, names_to = "ic_type", values_to = "model") -> selected_models

selected_models %>%
  group_by(name,species,datatype,ic_type) %>%
  mutate(total = n() )%>%
  ungroup()  %>%
  group_by(name,species,datatype,ic_type, model) %>%
  mutate(n = n()) %>%
  mutate(percent_top_model = n/total) -> percent_selected_momdels 
percent_selected_momdels
  
### another tibble with total number of models per ictype/datatype/name/species
selected_models %>%
  group_by(name,species,datatype,ic_type) %>%
  mutate(total = n() ) %>%
  group_by(ic_type,model) %>%
  tally() %>%
  ungroup()
  mutate(percent_ic_type = ic_type/total)
  

  dplyr::select(-n) %>%
  rename(most_common_model = model)
  


  #group_by(name, number, ic_type) %>%
  #mutate(ic_rank = rank(ic_value)) %>%
  #filter(ic_rank == 1) %>%
  #ungroup() %>%
  #dplyr::select(name, number, Model, ic_type) 




```



















